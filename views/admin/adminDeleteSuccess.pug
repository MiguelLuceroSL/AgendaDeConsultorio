doctype html
html
    head
        title Cambio de Estado Exitoso
        link(rel="stylesheet", href="/css/headerAdmin.css")
        link(rel="stylesheet", href="/css/styleGeneral1.css")
        link(rel="stylesheet", href="/css/adminCargarProfesional.css")
        link(rel="stylesheet" href="/css/adminDeleteProfesional.css")
        link(rel="stylesheet" href="/css/footer.css")
    body
        include ../includes/headerAdmin
        main(class="mainAdminDeleteProfesional") 
            section(class="deleteContainer")
                h1(class="mainTitle") ¡¡Estado de la especialidad cambiado exitosamente!!
                h1(class="mainTitle") Activar / Inactivar una Especialidad
                form(action="/admin/cambiarEstadoEspecialidad" method="POST" class="formChangeState" id="formCambiarEstado")
                    input(type="text" name="profesionalEspecialidadId" placeholder="ID de Profesional-Especialidad" required class="inputId" id="profesionalEspecialidadId")
                    input(type="hidden" name="confirmar" id="confirmarInput" value="false")
                    button(type="button" class="button" id="btnCambiarEstado") Cambiar de estado
        include ../includes/footer
        script(src="/js/logout.js")
        script.
            document.getElementById('btnCambiarEstado').addEventListener('click', async function(e) {
                e.preventDefault();
                const profesionalEspecialidadId = document.getElementById('profesionalEspecialidadId').value;
                
                if (!profesionalEspecialidadId) {
                    alert('Por favor ingrese el ID de Profesional-Especialidad');
                    return;
                }
                
                try {
                    // Verificar si tiene turnos pendientes
                    const response = await fetch(`/admin/verificarTurnosPendientes?profesionalEspecialidadId=${profesionalEspecialidadId}`);
                    const data = await response.json();
                    
                    let mensaje = 'Al cambiar el estado de la especialidad, se eliminarán sus agendas.';
                    
                    if (data.tieneTurnosPendientes) {
                        mensaje += `\n\nATENCIÓN: Esta especialidad tiene ${data.cantidadTurnos} turno(s) pendiente(s).\n\nSi continúa, estos turnos cambiarán a estado "Por reasignar" y la secretaria deberá reasignarlos a otro profesional de la misma especialidad.`;
                    }
                    
                    mensaje += '\n\n¿Desea continuar?';
                    
                    if (confirm(mensaje)) {
                        if (data.tieneTurnosPendientes) {
                            document.getElementById('confirmarInput').value = 'true';
                        }
                        document.getElementById('formCambiarEstado').submit();
                    }
                } catch (error) {
                    console.error('Error al verificar turnos:', error);
                    if (confirm('No se pudo verificar los turnos pendientes. ¿Desea continuar de todas formas?')) {
                        document.getElementById('formCambiarEstado').submit();
                    }
                }
            });